(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{379:function(a,s,t){"use strict";t.r(s);var e=t(8),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"lottery"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lottery"}},[a._v("#")]),a._v(" Lottery")]),a._v(" "),s("h2",{attrs:{id:"lottery梳理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lottery梳理"}},[a._v("#")]),a._v(" Lottery梳理")]),a._v(" "),s("p",[a._v("为根据不同人群标签的人群规律，选择不同的抽奖活动，每个活动的参与为一个抽奖单。可以有效的控制参与用户数和异常流程的补偿。领取抽奖单后执行使用了模板、工厂、策略的抽奖玩法设计。在这里设计了分段锁，避免独占锁的竞争，从而挺高效率。最后抽奖完成异步发送 MQ 消息方式进行驱动后续的发奖流程。")]),a._v(" "),s("h3",{attrs:{id:"简历"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简历"}},[a._v("#")]),a._v(" 简历")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("项目名称")]),a._v("：营销活动平台 - Lottery 微服务抽奖系统")]),a._v(" "),s("li",[s("strong",[a._v("系统架构")]),a._v("：以 DDD 领域驱动设计开发，微服务拆分的分布式系统架构")]),a._v(" "),s("li",[s("strong",[a._v("核心技术")]),a._v("：SpringBoot、MyBatis、Dubbo、MQ、MySQL、Redis、XDB-Router、ES、ZK")]),a._v(" "),s("li",[s("strong",[a._v("项目描述")]),a._v("：抽奖系统是营销平台的重要微服务之一，可以满足 C 端人群的需求，例如拉新、促活、留存等。该系统运用抽象、分治和 DDD 知识，拆解服务边界，凝练领域服务功能。围绕抽奖服务建设领域服务，包括规则引擎、抽奖策略、活动玩法、奖品发放等。这可以满足业务产品快速迭代上线的需求，同时减少研发成本，提高交付效率。")]),a._v(" "),s("li",[a._v("核心职责\n"),s("ul",[s("li",[a._v("【高级】构建以 DDD 分层结构的处理方式，搭建整个抽奖系统架构。运用设计原则和工厂、代理、模板、组合、策略等设计模式的综合使用，搭建易于维护和迭代的系统工程。")]),a._v(" "),s("li",[a._v("【高级】鉴于系统内有较多的规则策略过滤，包括准入、人群、风控、A/BTest等需求，为适应系统规模可快速开发和使用的方式，搭建了去中心化的量化人群规则引擎组件。通过业务需求对逻辑的扩展和内置引擎执行器的使用，完成自由组合的人群过滤服务。这降低了共性功能重复开发所带来的成本问题，并提高了研发效率。")]),a._v(" "),s("li",[a._v("【高级】根据实际秒杀峰值场景 "),s("code",[a._v("TPS 5000 ~ 8000")]),a._v(" 的需求，开发了统一路由组件。该组件不仅可以满足差异化不同字段的分库分表组合，还支持 Redis 库存分片和秒杀滑动库存分块。而且，开发了统一路由 XDB-Router 的 SpringBoot Starter 技术组件。该套组件已经经历了多次大促活动场景的考验，支持横向扩展，可以满足业务规模的快速增长。")]),a._v(" "),s("li",[a._v("【简单】运用模板、策略、工厂三个设计模式，定义抽奖过程标准和实现对应的多类型抽奖的服务模块。")]),a._v(" "),s("li",[a._v("【简单】因活动秒杀的并发场景，将秒杀从最开始的数据库行级锁优化为Redis Key 加锁，又从 Redis Key 的独占锁，优化为滑块锁。优化后整体秒杀有了非常可观的性能提升。")]),a._v(" "),s("li",[a._v("【简单】解耦抽奖流程，把抽奖和发奖用MQ消息串联起来，避免一个流程太长，导致用户一直等待。")])])])]),a._v(" "),s("h3",{attrs:{id:"基本流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基本流程"}},[a._v("#")]),a._v(" 基本流程")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://wwp-study-notes.oss-cn-nanjing.aliyuncs.com/imgs/lottery/%E6%8A%BD%E5%A5%96%E7%B3%BB%E7%BB%9F.png",alt:"抽奖系统"}})]),a._v(" "),s("h3",{attrs:{id:"参与活动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参与活动"}},[a._v("#")]),a._v(" 参与活动")]),a._v(" "),s("p",[a._v("组合模式搭建用于量化人群的规则引擎")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://wwp-study-notes.oss-cn-nanjing.aliyuncs.com/imgs/lottery/image-20231120151121588.png",alt:"image-20231120151121588"}})]),a._v(" "),s("h3",{attrs:{id:"抽奖策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#抽奖策略"}},[a._v("#")]),a._v(" 抽奖策略")]),a._v(" "),s("p",[a._v("策略模式配置抽奖策略")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://wwp-study-notes.oss-cn-nanjing.aliyuncs.com/imgs/lottery/image-20231120151338186.png",alt:"image-20231120151338186"}})]),a._v(" "),s("h3",{attrs:{id:"抽奖流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#抽奖流程"}},[a._v("#")]),a._v(" 抽奖流程")]),a._v(" "),s("p",[a._v("模版模式处理抽奖流程")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://wwp-study-notes.oss-cn-nanjing.aliyuncs.com/imgs/lottery/image-20231120151402768.png",alt:"image-20231120151402768"}})]),a._v(" "),s("h3",{attrs:{id:"活动状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#活动状态"}},[a._v("#")]),a._v(" 活动状态")]),a._v(" "),s("p",[a._v("状态模式处理活动状态变更")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://wwp-study-notes.oss-cn-nanjing.aliyuncs.com/imgs/lottery/image-20231120151559158.png",alt:"image-20231120151559158"}})]),a._v(" "),s("h3",{attrs:{id:"发放奖品"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发放奖品"}},[a._v("#")]),a._v(" 发放奖品")]),a._v(" "),s("p",[a._v("工厂模式发放各类别奖品")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://wwp-study-notes.oss-cn-nanjing.aliyuncs.com/imgs/lottery/image-20231120151702995.png",alt:"image-20231120151702995"}})]),a._v(" "),s("h3",{attrs:{id:"id生成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#id生成"}},[a._v("#")]),a._v(" Id生成")]),a._v(" "),s("p",[a._v("策略模式处理 id 生成")]),a._v(" "),s("ul",[s("li",[a._v("雪花算法、阿帕奇工具包 RandomStringUtils、日期拼接")]),a._v(" "),s("li",[a._v("三种方式生成ID，分别对应订单号、策略ID、活动号")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://wwp-study-notes.oss-cn-nanjing.aliyuncs.com/imgs/lottery/image-20231120151837274.png",alt:"image-20231120151837274"}})]),a._v(" "),s("h3",{attrs:{id:"对象转换"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对象转换"}},[a._v("#")]),a._v(" 对象转换")]),a._v(" "),s("p",[a._v("使用 MapStruct 做对象转换操作处理")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://wwp-study-notes.oss-cn-nanjing.aliyuncs.com/imgs/lottery/image-20231120152512949.png",alt:"image-20231120152512949"}})]),a._v(" "),s("h2",{attrs:{id:"lottery部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#lottery部署"}},[a._v("#")]),a._v(" Lottery部署")]),a._v(" "),s("h3",{attrs:{id:"安装-docker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-docker"}},[a._v("#")]),a._v(" 安装 "),s("code",[a._v("docker")])]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# centos")]),a._v("\nyum update "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 更新 yum 包")]),a._v("\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" yum-utils device-mapper-persistent-data lvm2\nyum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\nyum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" docker-ce\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看版本")]),a._v("\n\nsystemctl start "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\nsystemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 开机自启")]),a._v("\n")])])]),s("p",[s("code",[a._v("docker")]),a._v(" 常用命令")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--help")]),a._v("\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#Docker帮助")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--version")]),a._v("\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看Docker版本")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" search "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("image"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#搜索镜像文件，如：docker search mysql")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("image"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#拉取镜像文件， 如：docker pull mysql")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" images\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看已经拉取下来的所以镜像文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" rmi "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("image"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#删除指定镜像文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(":8080 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("image"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#发布指定镜像文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\t\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看正在运行的所有镜像")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v("\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#查看所有发布的镜像")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("image"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\t\t\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#删除执行已发布的镜像")]),a._v("\n")])])]),s("p",[s("strong",[a._v("安装 "),s("code",[a._v("Portainer")]),a._v(" 可视化工具")]),a._v("：通过 "),s("a",{attrs:{href:""}},[a._v("IP:9000")]),a._v(" 访问")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" portainer "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9000")]),a._v(":9000 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n/home/lzq/wwp/java/tools/data/docker/docker.sock:/var/run/docker.sock "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n/home/lzq/wwp/java/tools/data/portainer/data:/data "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n/home/lzq/wwp/java/tools/data/portainer/public:/public portainer/portainer\n")])])]),s("h3",{attrs:{id:"安装-mysql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-mysql"}},[a._v("#")]),a._v(" 安装 "),s("code",[a._v("mysql")])]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull mysql:8.0.27\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-id")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3306")]),a._v(":3306 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/lzq/wwp/java/tools/data/mysql/logs:/logs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/lzq/wwp/java/tools/data/mysql/data:/var/lib/mysql "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/lzq/wwp/java/tools/data/mysql/conf:/etc/mysql/conf.d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v(" mysql:8.0.27\n")])])]),s("p",[s("strong",[a._v("设置容器开启自动启动")])]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" update "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always 容器ID\n")])])]),s("h3",{attrs:{id:"安装-redis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-redis"}},[a._v("#")]),a._v(" 安装 "),s("code",[a._v("redis")])]),a._v(" "),s("p",[s("strong",[a._v("修改"),s("code",[a._v("conf")]),a._v(" 配置")])]),a._v(" "),s("ul",[s("li",[a._v("将"),s("code",[a._v("daemonize yes")]),a._v(" 设置为 no，否则与 docker -d 冲突")]),a._v(" "),s("li",[a._v("关闭保护模式，将 "),s("code",[a._v("protected-mode yes")]),a._v(" 设置为 no")]),a._v(" "),s("li",[a._v("注释掉 "),s("code",[a._v("bind 127.0.0.1")]),a._v("，以允许其他 ip 连接")]),a._v(" "),s("li",[a._v("开启密码认证（可选）"),s("code",[a._v("requirepass {yourpassword}")])])]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("6379")]),a._v(":6379 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" redis "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/lzq/wwp/java/tools/data/redis/redis.conf:/etc/redis/redis.conf  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/lzq/wwp/java/tools/data/redis/data:/data "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" redis:6.2.6 redis-server /etc/redis/redis.conf "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--appendonly")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("yes")]),a._v("\n")])])]),s("h3",{attrs:{id:"安装-zookeeper"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-zookeeper"}},[a._v("#")]),a._v(" 安装 "),s("code",[a._v("zookeeper")])]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull wurstmeister/zookeeper\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("TZ")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Asia/Shanghai"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2181")]),a._v(":2181 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/lzq/wwp/java/tools/data/zookeeper:/data "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" zookeeper "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--privileged")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true zookeeper "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" wurstmeister/zookeeper\n")])])]),s("h3",{attrs:{id:"安装-kafka"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-kafka"}},[a._v("#")]),a._v(" 安装 "),s("code",[a._v("kafka")])]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull wurstmeister/kafka\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" kafka "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("9092")]),a._v(":9092 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("KAFKA_BROKER_ID")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("KAFKA_ZOOKEEPER_CONNECT")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".167.144:2181 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("KAFKA_ADVERTISED_LISTENERS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("PLAINTEXT://192.168.167.144:9092 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("KAFKA_LISTENERS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("PLAINTEXT://0.0.0.0:9092 wurstmeister/kafka"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n")])])]),s("p",[a._v("**添加 "),s("code",[a._v("topic")])]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 进入容器")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-it")]),a._v(" kafka "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 测试")]),a._v("\nkafka-topics.sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--create")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--zookeeper")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".167.144:2181 --replication-factor "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--partitions")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--topic")]),a._v(" lottery_activity_partake\n\nkafka-topics.sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--create")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--zookeeper")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".167.144:2181 --replication-factor "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--partitions")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--topic")]),a._v(" lottery_invoice\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 创建发奖发票")]),a._v("\nkafka-topics.sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--create")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--zookeeper")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".167.144:2181 --replication-factor "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--partitions")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--topic")]),a._v(" lottery_invoice\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用 Redis 代替数据库活动库存，使用mq消息保证数据一致性，异步扣减活动库存")]),a._v("\nkafka-topics.sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--create")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--zookeeper")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".167.144:2181 --replication-factor "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--partitions")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--topic")]),a._v(" lottery_activity_partake\n")])])]),s("h3",{attrs:{id:"安装-xxl-job"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-xxl-job"}},[a._v("#")]),a._v(" 安装 "),s("code",[a._v("xxl-job")])]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull xuxueli/xxl-job-admin:2.3.0\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("PARAMS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('" --server.port=7397 --spring.datasource.url=jdbc:mysql://192.168.167.144:3306/xxl_job?useUnicode=true&characterEncoding=UTF-8&serverTimezone=GMT%2B8 --spring.datasource.username=root --spring.datasource.password=123456 --xxl.job.accessToken=xdsl3ewi3al1oehxmo68pqxer"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7397")]),a._v(":7397 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /home/lzq/wwp/java/tools/data/xxl-job/logs:/data/applogs "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" xxl-job-admin "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" xuxueli/xxl-job-admin:2.3.0\n")])])]),s("p",[s("a",{attrs:{href:"http://192.168.167.144:7397/xxl-job-admin/jobinfo",target:"_blank",rel:"noopener noreferrer"}},[a._v("调度台 "),s("code",[a._v("http://192.168.167.144:7397/xxl-job-admin")]),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"安装-nacos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-nacos"}},[a._v("#")]),a._v(" 安装 "),s("code",[a._v("nacos")])]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull nacos/nacos-server\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v(":8848 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--env")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MODE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("standalone  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" nacos  nacos/nacos-server\n")])])]),s("p",[a._v("打开链接："),s("a",{attrs:{href:"http://xn--IP-fr5c86lx7z:8848/nacos/",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://服务器IP:8848/nacos/)"),s("OutboundLink")],1),a._v(" - "),s("code",[a._v("账号：nacos 密码：nacos")])]),a._v(" "),s("h2",{attrs:{id:"补充"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#补充"}},[a._v("#")]),a._v(" 补充")]),a._v(" "),s("h3",{attrs:{id:"安装-rabbitmq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装-rabbitmq"}},[a._v("#")]),a._v(" 安装 "),s("code",[a._v("RabbitMQ")])]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" myRabbitMQ "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("RABBITMQ_DEFAULT_USER")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("admin "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("RABBITMQ_DEFAULT_PASS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("123456")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("15672")]),a._v(":15672 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5672")]),a._v(":5672 rabbitmq:3.8.14-management\n")])])]),s("p",[a._v("然后打开浏览器访问服务器公网"),s("code",[a._v("ip:15672")]),a._v("，输入创建的账号密码登录，登录成功代表docker安装并启动成功")]),a._v(" "),s("h3",{attrs:{id:"关闭防火墙"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关闭防火墙"}},[a._v("#")]),a._v(" 关闭防火墙")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("systemctl stop firewalld.service\nsystemctl disable firewalld.service\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);